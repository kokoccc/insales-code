*[← InSales Stuff](https://github.com/kokoccc/insales-code)*

# Liquid – продвинутое округление чисел

По умолчанию при выводе чисел Liquid отбрасывает нули, идущие после разделителя и цифр 1-9. Их еще называют trailing zeros или «конечными» нулями. Технически они никак не влияют на работу сайта, поэтому платформа считает их ненужными.

Но визуально это может быть не совсем красиво. Например, когда в настройках магазина включено отображение копеек, и у одного товара стоит цена 10.05 ₽, а у соседнего — 15.5 ₽.

Фильтр `round` с больши́ми значениями не помогает, фактически в InSales жизнеспособны только `round: 0` и `round: 1`:

|       | Запись                          | Результат   |
| ----- | ------------------------------- | ----------- |
| 1     | `{{ 10.240 }}`                  | `10.24`     |
| 2     | `{{ 10.240 \| round: 0 }}`      | `10`        |
| 3     | `{{ 10.240 \| round: 1 }}`      | `10.2`      |
| **4** | **`{{ 10.240 \| round: 3 }}`**  | **`10.24`** |
| **5** | **`{{ 10.240 \| round: 10 }}`** | **`10.24`** |
| 6     | `{{ 10.244 \| round: 3 }}`      | `10.244`    |

Проблема показана в выделенных строках 4 и 5.  
В строке 6 показано, что `round: 3` возвращает ожидаемый результат только при отсутствии нуля в конце.

Задача решается несколькими способами, но здесь приведен универсальный вариант — мы используем отдельный сниппет, который сам занимается расчетами и выдает готовый результат.

Кроме того, он принимает дополнительные параметры, позволяющие:
- округлить число до нужного количества знаков;
- установить разделитель классов (например, пробелы между миллионами, тысячами и сотнями);
- установить разделитель дробной части;
- включить отображение конечных нулей;
- вывести символ валюты.


## Подготовка

Создайте сниппет с любым названием (например, `liquid_round.liquid`) и скопируйте в него код по [этой ссылке](/liquid_round.liquid).

Код сниппета достаточно объемный, но в итоге в HTML-разметку отдается только итоговое значение, без лишних пробелов и переносов.

При необходимости вы можете отредактировать исходный код и изменить значения по умолчанию — все они идут в самом начале.


## Использование

Вызываем созданный сниппет и передаем в него параметры:
```liquid
{% include 'liquid_round', num: product.price, round: 2 %}
```

Обязательные параметры:
- **num** — число, которое надо округлить; можно передать переменную с числом

Необязательные параметры:
- **round** — количество знаков после разделителя, по умолчанию 0, т.е. округляем до целого
- **money** — если `true`, сниппет выведет число вместе со знаком текущей валюты, в соответствии с настройками магазина
- **class_delimiter** — символ, разделяющий классы числа (12345.00 → 12 345.00)
- **num_delimiter** — символ, разделяющий целую и дробную части
- **trailing** — если `true`, конечные нули не будут удалены

Несмотря на то, что параметр `round` необязательный, его рекомендуется передавать явно — слово round достаточно популярное, и если такая переменная уже объявлялась где-то ранее, сниппет может отработать некорректно.

Дополнительные примеры:

```liquid
{% include 'liquid_round', num: 10.5, round: 0, money: true %}
→ 11 ₽
```
```liquid
{% include 'liquid_round', num: 10.5, round: 1, money: true %}
→ 10.5 ₽
```
```liquid
{% include 'liquid_round', num: 10.5, round: 3, trailing: true %}
→ 10.500
```
```liquid
{% include 'liquid_round', num: 12345678.99, round: 5, trailing: true, class_delimiter: ' ', num_delimiter: '.' %}
→ 12 345 678.99000
```
```liquid
{% include 'liquid_round', num: -12345678.99, round: 5, trailing: true, class_delimiter: ' ', num_delimiter: '.', money: true %}
→ -12 345 678.99000 ₽, отрицательные числа тоже поддерживаются
```
